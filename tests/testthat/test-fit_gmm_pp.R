test_that("Poisson process fitting with Gaussian mixture rate function works on simple example as expected", {
  set.seed(42)
  X = rbind(c(0,0),c(-1,0),c(1,0),c(0,1),c(0,-1),c(5,5),c(4,5),c(5,6),c(6,5),c(5,4))
  D = data.frame(X)
  names(D) = c("Longitude","Latitude")
  D$Date = lubridate::mdy_hms(c("01/13/2019 08:30:00 PM", "01/17/2019 18:40:00 PM", "01/02/2019 05:35:00 PM", "01/20/2019 13:32:00 PM", "01/27/2019 22:35:00 PM", "01/30/2019 15:25:00 PM", "01/07/2019 02:35:00 PM", "01/03/2019 22:15:00 PM", "01/05/2019 05:35:00 PM", "01/09/2019 14:35:00 PM"))
  K = 2
  pp=fit_gmm_pp(D,K)
  expect_equal(pp$rate_func(0,0,1), 3.6995e-06, tolerance = 1e-06)
  expect_equal(pp$rate_func(0.5,0.5,3), 0.1102464, tolerance = 1e-06)
  expect_equal(pp$rate_params$C, 0.42208, tolerance = 1e-06)
  expect_equal(pp$rate_params$mus, rbind(c(0.919709,0.919709),c(-0.919709,-0.919709)), tolerance = 1e-05)
  expect_equal(pp$rate_params$sigmas[[1]], rbind(c(6.766917e-02,0),c(0,6.766917e-02)), tolerance = 1e-5)
  expect_equal(pp$rate_params$sigmas[[2]], rbind(c(6.766917e-02,0),c(0,6.766917e-02)), tolerance = 1e-5)
  expect_equal(pp$rate_params$ws, c(0.5,0.5), tolerance = 1e-17)
  expect_equal(pp$scaling_params$centre, c(2.5,2.5))
  expect_equal(pp$scaling_params$scale, c(2.718251,2.718251), tolerance=1e-06)
  rm(.Random.seed, envir=globalenv())
})
